<tool id="compil20" name="ComPIL 2.0" version="0.1.1" profile="20.09">
  <description>
    Warning: This is an early version of the tool, under active development. It is not yet production-ready.
  </description>
  <command>
    <![CDATA[
      ln -s $input_ms2 in.ms2 &&
      ln -s $__tool_directory__/sequest.params sequest.params &&
      cat $search_config > search.xml &&
      java -Xmx10G -jar $__tool_directory__/prolucid_compil.jar in.ms2 search.xml &&
      java -cp $__tool_directory__/DTASelect -noDB
    ]]>
  </command>

  <configfiles>
    <!-- TODO: complete heavy_search_mode, search_mode, and modifications sections -->
    <configfile name="search_config"><![CDATA[#slurp
<?xml version="1.0" encoding="UTF-8"?>
<!--Parameters for ProLuCID database search-->
<parameters>
  <database>
	<is_indexed>false</is_indexed>
	<mongo_db_name>$database</mongo_db_name>
    <mongo_uri>$advanced_db_config.mongo_uri</mongo_uri>
  </database>
  <heavy_search_mode>
    <is_n15_search>yes</is_n15_search>
    <heavy_atomic_enrichment>95</heavy_atomic_enrichment>
    <heavy_mods />
  </heavy_search_mode>
  <search_mode>
    <primary_score_type>1</primary_score_type>
    <secondary_score_type>0</secondary_score_type>
    <locus_type>1</locus_type>
    <charge_disambiguation>0</charge_disambiguation>
    <atomic_enrichement>0</atomic_enrichement>
    <min_match>0</min_match>
    <peak_rank_threshold>200</peak_rank_threshold>
    <candidate_peptide_threshold>500</candidate_peptide_threshold>
    <num_output>5</num_output>
    <is_decharged>0</is_decharged>
    <fragmentation_method>CID</fragmentation_method>
    <preprocess>1</preprocess>
  </search_mode>
  <isotopes>
    <precursor>$isotopes.precursor</precursor>
    <fragment>$isotopes.fragment</fragment>
    <num_peaks>$isotopes.num_peaks</num_peaks>
  </isotopes>
  <tolerance>
    <precursor_high>$tolerance.precursor_high</precursor_high>
    <precursor_low>$tolerance.precursor_low</precursor_low>
    <precursor>$tolerance.precursor</precursor>
    <fragment>$tolerance.fragment</fragment>
  </tolerance>
  <precursor_mass_limits>
    <minimum>$precursor_mass_limits.minimum</minimum>
    <maximum>$precursor_mass_limits.maximum</maximum>
  </precursor_mass_limits>
  <precursor_charge_limits>
    <minimum>$precursor_charge_limits.minimum</minimum>
    <maximum>$precursor_charge_limits.maximum</maximum>
  </precursor_charge_limits>
  <peptide_length_limits>
    <minimum>$peptide_length_limits.minimum</minimum>
  </peptide_length_limits>
  <num_peak_limits>
    <minimum>$num_peak_limits.minimum</minimum>
    <maximum>$num_peak_limits.maximum</maximum>
  </num_peak_limits>
  <max_num_diffmod>3</max_num_diffmod>
  <modifications>
    <display_mod>0</display_mod>
    <n_term>
      <static_mod>
        <symbol>*</symbol>
        <mass_shift>0.0</mass_shift>
      </static_mod>
      <diff_mods>
        <diff_mod>
          <symbol>*</symbol>
          <mass_shift>0.0</mass_shift>
        </diff_mod>
      </diff_mods>
    </n_term>
    <c_term>
      <static_mod>
        <symbol>*</symbol>
        <mass_shift>0.0</mass_shift>
      </static_mod>
      <diff_mods>
        <diff_mod>
          <symbol>*</symbol>
          <mass_shift>0.0</mass_shift>
        </diff_mod>
      </diff_mods>
    </c_term>
    <static_mods>
      <static_mod>
        <symbol>*</symbol>
        <mass_shift>57.02146</mass_shift>
        <residue>C</residue>
      </static_mod>
    </static_mods>
    <diff_mods>
      <diff_mod>
        <symbol>*</symbol>
        <mass_shift>79.9663</mass_shift>
        <residues>
          <residue>S</residue>
          <residue>T</residue>
          <residue>Y</residue>
        </residues>
      </diff_mod>
    </diff_mods>
  </modifications>
  <enzyme_info>
    <name>$enzyme_info.name</name>
    <specificity>$enzyme_info.specificity</specificity>
    <type>$enzyme_info.type</type>
    <residues>
#for $residue in $enzyme_info.residues:
      <residue>$residue</residue>
#end for
    </residues>
  </enzyme_info>
</parameters>
 ]]></configfile>
  </configfiles>

  <inputs>
    <param name="input_ms2" type="data" format="ms2" label="Input MS2 File" />

    <param name="database" label="Database" type="select">
      <option selected="true" value="compil20" >ComPIL 2.0</option>
      <option value="uniprot">Uniprot</option>
      <option value="hunterDB">hunterDB</option>
    </param>
    <section name="advanced_db_config" expanded="False" title="Advanced Database Configuration">
      <param name="mongo_uri" label="Mongo URI" value="mongodb://localhost:27017" type="text" optional="true"/>
    </section>
    <section name="isotopes" expanded="False" title="Isotopes">
      <param name="precursor" label="Precursor" value="mono" type="text" optional="true"/>
      <param name="fragment" label="Fragment" value="mono" type="text" optional="true"/>
      <param name="num_peaks" label="Number of Peaks" value="0" type="integer" optional="true"/>
    </section>
    <section name="tolerance" expanded="False" title="Tolerance">
      <param name="precursor_high" label="Precursor high" value="3000.0" type="float" optional="true"/>
      <param name="precursor_low" label="Precursor low" value="3000.0" type="float" optional="true"/>
      <param name="precursor" label="Precursor" value="50" type="integer" optional="true"/>
      <param name="fragment" label="Fragment" value="600.0" type="float" optional="true"/>
    </section>
    <section name="precursor_mass_limits" expanded="False" title="Precursor Mass Limits">
      <param name="minimum" label="Minimum" value="600" type="integer" optional="true"/>
      <param name="maximum" label="Maximum" value="6000" type="integer" optional="true"/>
    </section>
    <section name="precursor_charge_limits" expanded="False" title="Precursor Charge Limits">
      <param name="minimum" label="Minimum" value="0" type="integer" optional="true"/>
      <param name="maximum" label="Maximum" value="1000" type="integer" optional="true"/>
    </section>
    <section name="peptide_length_limits" expanded="False" title="Peptide Length Limits">
      <param name="minimum" label="Minimum" value="6" type="integer" optional="true"/>
    </section>
    <section name="num_peak_limits" expanded="False" title="Num. Peak Limits">
      <param name="minimum" label="Minimum" value="25" type="integer" optional="true"/>
      <param name="maximum" label="Maximum" value="5000" type="integer" optional="true"/>
    </section>
    <param name="max_num_diffmod" label="max_num_diffmod" value="3" type="integer" optional="true"/>
    <section name="enzyme_info" expanded="False" title="Enzyme Info">
      <param name="name" label="Name" value="trypsin" type="text" optional="true"/>
      <param name="specificity" label="Specificity" value="2" type="integer" optional="true"/>
      <param name="type" label="Type" truevalue="true" falsevalue="false" type="boolean" checked="true"/>
      <param name="residues" label="Residues" type="select" multiple="true">
        <option selected="true" value="K">K</option>
        <option selected="true" value="R">R</option>
      </param>
    </section>
</inputs>
  <outputs>
    <data name="output_sqt" format="text" from_work_dir="input.sqt" label="ComPIL 2.0 Output SQT"/>
    <data name="output_dta_html" format="html" from_work_dir="DTASelect.html" label="DTASelect Output HTML"/>
  </outputs>
  <help><![CDATA[
**ComPIL 2.0**

ComPIL 2.0 searches MS/MS data against a FASTA database of known proteins.

Two outputs are produced:

- ComPIL Output SQT
- ComPIL Output HTML - an HTML summary of results

A single input required: an MS2 file

The database to search is selected from a set of pre-prepared databases hosted by the public ComPIL 2.0 server.
    ]]>
  </help>
</tool>
