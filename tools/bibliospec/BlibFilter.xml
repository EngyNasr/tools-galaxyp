<tool id="BlibFilter" name="BlibFilter" version="@VERSION@.0">
    <description>remove redundant spectra from a library</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        BlibFilter 
        --min-peaks $min_peaks
        --min-score $min_score
        --best-scoring $best_scoring
        '$redundant_blib' '$filtered_blib'
        #if $convert_to_ms2:
            && BlibToMs2 -f '$ms2' '$filtered_blib'
        #end if
    ]]></command>
    <inputs>
        <param name="redundant_blib" type="data" format="sqlite" label="Redundant Blib"/>
        <param name="min_peaks" type="integer" value="1" min="1" 
            label="Only include spectra with at least this peaks"
            help="--min-peaks"/>
        <param name="min_score" type="float" value="0" min="0"
            label="Best spectrum must have at least this average score to be included."
            help="--min-score"/>
        <param name="best_scoring" type="boolean" truevalue="1" falsevalue="0" checked="false"
            label="Use best scoring"/>
        <param name="convert_to_ms2" type="boolean" truevalue="yes" falsevalue="no" label="Output a MS2"/>
    </inputs>
    <outputs>
        <data name="filtered_blib" format="sqlite" label="Filtered Blib"/>
        <data name="ms2" format="ms2" label="MS2 from ${on_string}" from_work_dir="spectra.ms2" >
            <filter>convert_to_ms2 == True</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="redundant_blib" ftype="sqlite" value="msgf.blib"/>
            <param name="convert_to_ms2" value="True"/>
            <output name="ms2">
                <assert_contents>
                    <has_text text="D\tseq\tFKWNGTDTNSAAEK" />
                    <has_text text="D\tmodified seq\tFKWNGTDTNSAAEK" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
BiblioSpec_ is a suite of software tools for creating and searching MS/MS peptide spectrum libraries.

BlibFilter_ creates a library of peptide MS/MS spectra from a variety of different database search results. 

::

  Usage: BlibFilter [options] <redundant-library> <filtered-library>

  Options:
    -m [ --memory-cache ] arg (=250)  SQLite memory cache size in Megs.  Default
                                      250M.
    -n [ --min-peaks ] arg (=1)       Only include spectra with at least this
                                      many peaks.  Default 1.
    -s [ --min-score ] arg (=0)       Best spectrum must have at least this
                                      average score to be included.  Default 0.
    -b [ --best-scoring ] arg (=0)    Description of option.  Default false.
    -p [ --parameter-file ] arg       File containing search parameters.  Command
                                      line values override file values.
    -v [ --verbosity ] arg (=status)  Control the level of output to stderr.
                                      (silent, error, status, warn, debug,
                                      detail, all)  Default status.
    -h [ --help ]                     Print help message.
  

.. _BlibFilter: https://skyline.ms/wiki/home/software/BiblioSpec/page.view?name=BlibFilter
.. _BiblioSpec: https://skyline.ms/project/home/software/BiblioSpec/begin.view?
    ]]></help>
    <expand macro="citations" />
</tool>
